# vim: ft=python
import glob
import pandas as pd

configfile: 'typeseq_config.yaml'
workdir: os.environ['PWD']
shell.executable('bash')



rule dev_dmx_all:
    input:
        expand('fastq_demux2/{bc1}.{bc2}.fastq', bc2=bc2s, bc1=bc1s)



rule rawlib_bam_to_fastq:
    input: 'single_demux_bams/IonXpress_{bc1}_rawlib.bam'
    output: 'fastq_rawlib/{bc1}.demux1.fastq'
    threads: 2
    shell:
        'bamtofastq < {input} > {output}'


### Create a rule that will parse the barcodes into multiple lists by length
### see /CGF/Sequencing/Analysis/Research/RD111_HPVTyping/RD111_typing_DOI_Exp1_20210319


rule demux_fastq:
    input: 'fastq_rawlib/{bc1}.demux1.fastq'
    output: expand('fastq_demux2/{{bc1}}.{bc2}.fastq', bc2=bc2s)
    threads: 2
    params:
        bc1 = 'barcodes/barcodeList_TypingV1_v2-barcodes_01.tsv'
    shell: '''
        cat {input} | \
            fastx_barcode_splitter.pl \
            --bcfile {params.bc1} \
            --partial 1 \
            --mismatches 1 \
            --prefix fastq_demux2/{wildcards.bc1}. \
            --suffix .fastq \
            --eol
        '''
